<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>iOSä¸­çš„Hit-Testing | Sugite</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="iOS," />
  

  <meta name="description" content="é—®é¢˜èƒŒæ™¯ç¾å›¢iOSå®¢æˆ·ç«¯ç”µå½±é¢‘é“ä¸­ï¼Œå½±é™¢åˆ—è¡¨çš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š  æ¯ä¸ªå½±é™¢Cellä¸­çš„æ”¾æ˜ åœºæ¬¡éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çº¢è‰²çŸ©å½¢æ¡†æ ‡è®°çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯ç”¨UICollectionViewå®Œæˆçš„ï¼Œä¹‹å‰ä»£ç å°†UICollectionViewçš„å®½åº¦å›ºå®šï¼Œæ‰€ä»¥å¯¼è‡´ç‚¹å‡»ç©ºç™½åŒºåŸŸçš„æ—¶å€™ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç‚¹å‡»åˆ°äº†UICollectionViewä¸Šï¼Œç»§è€Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ— å“åº”ï¼Œå½±å“äº†ç”¨æˆ·ä½“éªŒã€‚ æ‰€ä»¥ç°åœ¨éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ”¾æ˜ åœºæ¬¡">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="iOSä¸­çš„Hit-Testing">
<meta property="og:url" content="http://www.dengbo.me/2016/08/17/iOSä¸­çš„Hit-Testing/index.html">
<meta property="og:site_name" content="Sugite">
<meta property="og:description" content="é—®é¢˜èƒŒæ™¯ç¾å›¢iOSå®¢æˆ·ç«¯ç”µå½±é¢‘é“ä¸­ï¼Œå½±é™¢åˆ—è¡¨çš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š  æ¯ä¸ªå½±é™¢Cellä¸­çš„æ”¾æ˜ åœºæ¬¡éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çº¢è‰²çŸ©å½¢æ¡†æ ‡è®°çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯ç”¨UICollectionViewå®Œæˆçš„ï¼Œä¹‹å‰ä»£ç å°†UICollectionViewçš„å®½åº¦å›ºå®šï¼Œæ‰€ä»¥å¯¼è‡´ç‚¹å‡»ç©ºç™½åŒºåŸŸçš„æ—¶å€™ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç‚¹å‡»åˆ°äº†UICollectionViewä¸Šï¼Œç»§è€Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ— å“åº”ï¼Œå½±å“äº†ç”¨æˆ·ä½“éªŒã€‚ æ‰€ä»¥ç°åœ¨éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ”¾æ˜ åœºæ¬¡">
<meta property="og:locale" content="zh-TW">
<meta property="og:image" content="http://7otic0.com1.z0.glb.clouddn.com/CinemaCellWithScheduler.jpeg">
<meta property="og:image" content="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/hit_testing_2x.png">
<meta property="og:image" content="http://7otic0.com1.z0.glb.clouddn.com/hit-test-flowchart.png">
<meta property="og:updated_time" content="2017-09-08T09:36:56.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOSä¸­çš„Hit-Testing">
<meta name="twitter:description" content="é—®é¢˜èƒŒæ™¯ç¾å›¢iOSå®¢æˆ·ç«¯ç”µå½±é¢‘é“ä¸­ï¼Œå½±é™¢åˆ—è¡¨çš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š  æ¯ä¸ªå½±é™¢Cellä¸­çš„æ”¾æ˜ åœºæ¬¡éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çº¢è‰²çŸ©å½¢æ¡†æ ‡è®°çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯ç”¨UICollectionViewå®Œæˆçš„ï¼Œä¹‹å‰ä»£ç å°†UICollectionViewçš„å®½åº¦å›ºå®šï¼Œæ‰€ä»¥å¯¼è‡´ç‚¹å‡»ç©ºç™½åŒºåŸŸçš„æ—¶å€™ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç‚¹å‡»åˆ°äº†UICollectionViewä¸Šï¼Œç»§è€Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ— å“åº”ï¼Œå½±å“äº†ç”¨æˆ·ä½“éªŒã€‚ æ‰€ä»¥ç°åœ¨éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ”¾æ˜ åœºæ¬¡">
<meta name="twitter:image" content="http://7otic0.com1.z0.glb.clouddn.com/CinemaCellWithScheduler.jpeg">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=c114cbe6" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  

  


  
    <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  
    <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.3.0/css/font-awesome.min.css">
  
</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">è½»å¸Œ</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">è½»å¸Œ</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            åšå®¢
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/category/"
            rel="noopener noreferrer"
            target="_self"
            >
            åˆ†ç±»
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tag/"
            rel="noopener noreferrer"
            target="_self"
            >
            æ ‡ç­¾
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/atom.xml"
            rel="noopener noreferrer"
            target="_blank"
            >
            RSS
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/search/"
            rel="noopener noreferrer"
            target="_self"
            >
            æœç´¢
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#é—®é¢˜èƒŒæ™¯"><span class="toc-text">é—®é¢˜èƒŒæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç¬¬ä¸€ååº”"><span class="toc-text">ç¬¬ä¸€ååº”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hit-Testing-in-iOS"><span class="toc-text">Hit-Testing in iOS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è§£å†³æ–¹æ¡ˆ"><span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-iOSä¸­çš„Hit-Testing" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">iOSä¸­çš„Hit-Testing</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2016.08.17</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>Sugite</span>
        </span>
      

      
  <span class="article-category">
    <i class="icon-list"></i>
    <a class="article-category-link" href="/categories/ğŸµ/">ğŸµ</a>
  </span>



      

      
      <i class="fa fa-eye"></i> 
        <span id="busuanzi_container_page_pv">
           &nbspçƒ­åº¦ <span id="busuanzi_value_page_pv">
           <i class="fa fa-spinner fa-spin"></i></span>â„ƒ
        </span>
      

      
      
    </div>
  </header>

  <div class="article-content">
    
      <h2 id="é—®é¢˜èƒŒæ™¯"><a href="#é—®é¢˜èƒŒæ™¯" class="headerlink" title="é—®é¢˜èƒŒæ™¯"></a>é—®é¢˜èƒŒæ™¯</h2><p>ç¾å›¢iOSå®¢æˆ·ç«¯ç”µå½±é¢‘é“ä¸­ï¼Œå½±é™¢åˆ—è¡¨çš„ç•Œé¢å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><a href="url"><img src="http://7otic0.com1.z0.glb.clouddn.com/CinemaCellWithScheduler.jpeg" alt="å½±é™¢åˆ—è¡¨Cell" height="200" width="250"></a></p>
<p>æ¯ä¸ªå½±é™¢Cellä¸­çš„æ”¾æ˜ åœºæ¬¡éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çº¢è‰²çŸ©å½¢æ¡†æ ‡è®°çš„éƒ¨åˆ†ï¼Œéƒ½æ˜¯ç”¨UICollectionViewå®Œæˆçš„ï¼Œä¹‹å‰ä»£ç å°†UICollectionViewçš„å®½åº¦å›ºå®šï¼Œæ‰€ä»¥å¯¼è‡´ç‚¹å‡»ç©ºç™½åŒºåŸŸçš„æ—¶å€™ï¼Œå®é™…ä¸Šä¹Ÿæ˜¯ç‚¹å‡»åˆ°äº†UICollectionViewä¸Šï¼Œç»§è€Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ— å“åº”ï¼Œå½±å“äº†ç”¨æˆ·ä½“éªŒã€‚</p>
<p>æ‰€ä»¥ç°åœ¨éœ€è¦å¯¹å…¶è¿›è¡Œæ”¹è¿›ï¼Œä½¿å¾—ç”¨æˆ·ç‚¹å‡»æ”¾æ˜ åœºæ¬¡æ—è¾¹çš„ç©ºç™½åŒºåŸŸçš„æ—¶å€™ï¼Œè·Ÿç‚¹å‡»å½±é™¢Cellçš„å“åº”ä¸€æ ·ï¼Œéƒ½è¿›å…¥ä¸‹çº§é¡µé¢ï¼Œè€Œä¸æ˜¯æ— å“åº”ã€‚</p>
<h2 id="ç¬¬ä¸€ååº”"><a href="#ç¬¬ä¸€ååº”" class="headerlink" title="ç¬¬ä¸€ååº”"></a>ç¬¬ä¸€ååº”</h2><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œè‡ªå·±é¦–å…ˆæƒ³åˆ°çš„æ˜¯å°†UICollectionViewçš„å®½åº¦ä¸å›ºå®šï¼Œè€Œæ˜¯æ ¹æ®å†…å®¹è‡ªåŠ¨è®¡ç®—å®½åº¦ï¼Œè¿™æ ·UICollectionViewå°±ä¸ä¼šé®æŒ¡ä½å½±é™¢Cellï¼Œç‚¹å‡»ç©ºç™½åŒºåŸŸä¹Ÿå°±æ˜¯ç›´æ¥ç‚¹å‡»å½±é™¢Celläº†ï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è™½ç„¶å³è¾¹ç©ºç™½åŒºåŸŸçš„é—®é¢˜è§£å†³äº†ï¼Œä½†æ˜¯æ”¾æ˜ åœºæ¬¡ä¹‹é—´çš„é—´éš™ä»ç„¶ä¼šç‚¹å‡»æ— å“åº”ï¼ŒæŸç§ç¨‹åº¦ä¸Šæ¥è¯´ï¼Œè¿˜æ˜¯æœ‰ç‘•ç–µã€‚</p>
<p>ç¬¬äºŒä¸ªæƒ³æ³•æ˜¯ï¼Œåˆ©ç”¨UICollectionViewçš„backgroundViewåšæ–‡ç« ï¼Œæˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªbackgroundViewï¼Œç„¶åä¸ºå®ƒæ·»åŠ ä¸€ä¸ªtapæ‰‹åŠ¿çš„ç›‘å¬ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·ç‚¹å‡»UICollectionViewçš„ç©ºç™½åŒºåŸŸæ—¶ï¼Œå°±å¯ä»¥æ•è·åˆ°è¯¥äº‹ä»¶ï¼Œä»è€Œåšå‡ºç›¸åº”çš„å“åº”ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.collectionView.backgroundView = [[<span class="built_in">UIView</span> alloc] init];</div><div class="line">[<span class="keyword">self</span>.collectionView addGestureRecognizer:[[<span class="built_in">UITapGestureRecognizer</span> alloc] initWithTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(handleBackgroundTap)]];</div></pre></td></tr></table></figure>
<p>è¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨<code>handleBackgroundTap</code>ä¸­å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œç„¶è€Œé—®é¢˜æ¥äº†ï¼Œè¿™é‡Œçš„collectionViewæ˜¯å½±é™¢Cellçš„ä¸€ä¸ªå±æ€§ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨<code>handleBackgroundTap</code>ä¸­è°ƒç”¨<code>- tableView:didSelectRowAtIndexPath:</code>æ–¹æ³•å‘¢ï¼Œæƒ³äº†ä¸€ä¼šå„¿ï¼Œæ„Ÿè§‰æ²¡æœ‰ç‰¹åˆ«ç®€æ´çš„æ–¹æ³•ï¼Œæ‰€ä»¥å°±æ”¾å¼ƒäº†è¿™ç§æ€è·¯ã€‚</p>
<h2 id="Hit-Testing-in-iOS"><a href="#Hit-Testing-in-iOS" class="headerlink" title="Hit-Testing in iOS"></a>Hit-Testing in iOS</h2><p>ä¸Šè¿°ä¸¤ç§æ€è·¯éƒ½æ¯™æ‰åï¼Œçœ‹äº†ä¸€ä¸‹Appleå…³äº<a href="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/event_delivery_responder_chain/event_delivery_responder_chain.html#//apple_ref/doc/uid/TP40009541-CH4-SW4" target="_blank" rel="external">Hit-Testing</a>çš„æ–‡æ¡£ï¼Œäº†è§£äº†ä¸€ä¸‹iOSä¸­è§¦æ‘¸äº‹ä»¶çš„åŸç†å’Œæµç¨‹ï¼Œå‘ç°å¯ä»¥é€šè¿‡è¦†å†™<code>-hitTest:withEvent:</code>æ–¹æ³•æ¥è¾¾åˆ°ç›®çš„ï¼Œè¿™é‡Œå…ˆç®€å•è¯´ä¸€ä¸‹Hit-Testingã€‚</p>
<p>iOSç”¨hit-testingæœºåˆ¶æ¥æ‰¾åˆ°ç”¨æ¥å“åº”ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶çš„viewã€‚Hit-testingçš„ä¸»è¦å·¥ä½œå°±æ˜¯æ£€æŸ¥æŸä¸ªè§¦æ‘¸äº‹ä»¶å‘ç”Ÿçš„ä½ç½®æ˜¯å¦åœ¨ç›¸å…³è”çš„æŸä¸ªviewè¾¹ç•Œå†…ã€‚å¦‚æœæ˜¯ï¼Œå®ƒå°±ä¼šé€’å½’æ£€æŸ¥è¯¥viewçš„subviewsã€‚è€Œæ•´ä¸ªviewæ ‘ä¸­ï¼Œæœ€åº•å±‚çš„ä¸€ä¸ªåŒ…å«è§¦æ‘¸ä½ç½®çš„viewå°†ä¼šæˆä¸ºhit-test viewã€‚åœ¨iOSæ‰¾åˆ°æ¥hit-test viewåï¼Œå°±å°†è§¦æ‘¸äº‹ä»¶äº¤ç»™è¯¥viewå»å¤„ç†ã€‚</p>
<p><a href="url"><img src="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/Art/hit_testing_2x.png" alt="Hit-testing returns the subview that was touched" height="360" width="240"></a></p>
<p>ä¸ºäº†è§£é‡Šä¸€ä¸‹hit-testingæœºåˆ¶ï¼Œä»¥ä¸Šå›¾ä¸ºä¾‹å…·ä½“è¯´æ˜ä¸€ä¸‹ï¼Œå‡è®¾ç”¨æˆ·ç‚¹å‡»äº†View EåŒºåŸŸï¼Œé‚£ä¹ˆiOSé€šè¿‡ä»¥ä¸‹é¡ºåºæ¥æ£€æŸ¥subviewsä»¥æ‰¾åˆ°hit-test viewï¼š</p>
<ol>
<li>è§¦æ‘¸ä½ç½®åœ¨è§†å›¾Açš„è¾¹ç•Œå†…ï¼Œæ‰€ä»¥å®ƒä¼šç»§ç»­æ£€æŸ¥è‡ªè§†å›¾Bå’ŒCã€‚</li>
<li>è§¦æ‘¸ä½ç½®ä¸åœ¨è§†å›¾Bçš„è¾¹ç•Œå†…ï¼Œä½†æ˜¯åœ¨è§†å›¾Cçš„è¾¹ç•Œå†…ï¼Œæ‰€ä»¥ç»§ç»­æ£€æŸ¥è‡ªè§†å›¾Då’ŒEã€‚</li>
<li>è§¦æ‘¸ä½ç½®ä¸åœ¨è§†å›¾Dçš„è¾¹ç•Œå†…ï¼Œä½†æ˜¯åœ¨è§†å›¾Eçš„è¾¹ç•Œå†…ã€‚</li>
</ol>
<p>è§†å›¾Eæ˜¯è§†å›¾å±‚çº§ä½“ç³»ä¸­åŒ…å«è§¦æ‘¸ä½ç½®çš„æœ€åº•å±‚è§†å›¾ï¼Œæ‰€ä»¥å®ƒå°±æˆä¸ºäº†hit-test viewã€‚<br>å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ç§æ™®éæƒ…å†µå°±æ˜¯ï¼Œå‡å¦‚è§†å›¾Då’Œè§†å›¾Eé‡å äº†ï¼Œè€Œç”¨æˆ·æ°å¥½ç‚¹å‡»äº†é‡å åŒºåŸŸï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œhit-test viewå°†ä¼šæ˜¯subviewç´¢å¼•ä¸­çš„è¾ƒå¤§è€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯å…ˆaddSubview Dï¼Œå†addSubview Eï¼Œé‚£ä¹ˆå°±æ˜¯Eï¼Œåä¹‹åˆ™æ˜¯Dã€‚</p>
<p>ä¸‹é¢æ˜¯hit-testingçš„æµç¨‹å›¾ï¼š</p>
<p><img src="http://7otic0.com1.z0.glb.clouddn.com/hit-test-flowchart.png" alt="hit-test-flowchart"></p>
<p>è¿™ä¸ªå›¾æ¸…æ¥šçš„è§£é‡Šäº†<code>-hitTest:withEvent:</code>çš„å…·ä½“å®ç°ï¼Œç›¸åº”çš„ä»£ç å®ç°åˆ™æ˜¯ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isUserInteractionEnabled || <span class="keyword">self</span>.isHidden || <span class="keyword">self</span>.alpha &lt;= <span class="number">0.01</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span> pointInside:point withEvent:event]) &#123;</div><div class="line">        <span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> [<span class="keyword">self</span>.subviews reverseObjectEnumerator]) &#123;</div><div class="line">            <span class="built_in">CGPoint</span> convertedPoint = [subview convertPoint:point fromView:<span class="keyword">self</span>];</div><div class="line">            <span class="built_in">UIView</span> *hitTestView = [subview hitTest:convertedPoint withEvent:event];</div><div class="line">            <span class="keyword">if</span> (hitTestView) &#123;</div><div class="line">                <span class="keyword">return</span> hitTestView;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>hitTest:withEvent:</code>æ–¹æ³•é¦–å…ˆä¼šæ£€æŸ¥ä¸€ä¸ªviewæ˜¯å¦å…è®¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œä¸€ä¸ªviewå…è®¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶çš„æ¡ä»¶æ˜¯ï¼š</p>
<ul>
<li>viewä¸ºè¢«éšè—:<code>self.hidden == NO</code></li>
<li>viewå…è®¸äº¤äº’:<code>self.userInteractionEnabled == YES</code></li>
<li>viewé€æ˜åº¦å¤§äº0.01:<code>self.alpha &gt; 0.01</code></li>
<li>è§¦æ‘¸ä½ç½®åœ¨viewè¾¹ç•Œå†…:<code>pointInside:withEvent: == YES</code></li>
</ul>
<p>å¦‚æœä¸€ä¸ªviewå…è®¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•å°±ä¼šé€šè¿‡æŒ‰é€†åºé¡ºåºå‘subviewså‘é€<code>hitTest:withEvent:</code>æ¶ˆæ¯çš„æ–¹å¼éå†ï¼Œç›´åˆ°è¿”å›ä¸€ä¸ªéç©ºå€¼ã€‚å¦‚æœæ‰€æœ‰subviewsè¿”å›ç©ºæˆ–è€…æ²¡æœ‰subviewï¼Œåˆ™è¿”å›è‡ªèº«ã€‚</p>
<p>å¦åˆ™ï¼Œå¦‚æœä¸€ä¸ªè§†å›¾ä¸å…è®¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œè¿™ä¸ªæ–¹æ³•ç›´æ¥æ”¾å›nilï¼Œå¹¶ä¸”ä¸å†éå†è§†å›¾å±‚çº§ä¸Šçš„è‡ªè§†å›¾ã€‚</p>
<h2 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h2><p>åœ¨äº†è§£äº†iOSçš„hit-testingæœºåˆ¶åï¼Œå†å›åˆ°å¼€å¤´æåˆ°çš„é—®é¢˜ï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡é‡å†™UICollectionViewçš„<code>hitTest:withEvent:</code>æ–¹æ³•ï¼Œæ”¹å˜å®ƒæ¥æ”¶è§¦æ‘¸äº‹ä»¶çš„é»˜è®¤å¤„ç†æ–¹å¼å³å¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“hit-testæ£€æŸ¥åˆ°UICollectionViewçš„æ—¶å€™ï¼ŒåŠ ä»¥åˆ¤æ–­ï¼Œå¦‚æœç‚¹å‡»çš„æ˜¯æ”¾æ˜ åœºæ¬¡Cellï¼Œé‚£ä¹ˆç›´æ¥è¿”å›è¯¥Cellï¼Œå¦‚æœç‚¹å‡»çš„æ˜¯ç©ºç™½åŒºåŸŸï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸è¿”å›UICollectionViewï¼Œè€Œæ˜¯ç›´æ¥è¿”å›nilï¼Œè¿™æ ·ï¼Œæœ€åº•å±‚çš„å“åº”è€…å°±åº”è¯¥æ˜¯å½±é™¢Cellï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">MyUICollectionView</span> : <span class="title">UICollectionView</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">MyUICollectionView</span></span></div><div class="line"></div><div class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isUserInteractionEnabled || <span class="keyword">self</span>.isHidden || <span class="keyword">self</span>.alpha &lt;= <span class="number">0.01</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UIView</span> *subview <span class="keyword">in</span> <span class="keyword">self</span>.subviews.reverseObjectEnumerator) &#123;</div><div class="line">        <span class="built_in">CGPoint</span> subPoint = [subview convertPoint:point fromView:<span class="keyword">self</span>];</div><div class="line">        <span class="built_in">UIView</span> *result = [subview hitTest:subPoint withEvent:event];</div><div class="line">        <span class="keyword">if</span> (result) &#123;</div><div class="line">            <span class="keyword">return</span> result;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™æ ·èƒ½å®Œå…¨è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ï¼Œä½†æ˜¯çœ‹ä¸Šå»æœ‰ç‚¹åˆ«æ‰­ï¼Œå› ä¸ºæˆ‘ä»¬æ–°å»ºäº†ä¸€ä¸ª<code>MyUICollectionView</code>ç±»ï¼Œæ˜¾å¾—éå¸¸çªå…€ï¼Œé‚£ä¹ˆï¼Œæ¢ä¸ªæ€è·¯ï¼Œæ—¢ç„¶æˆ‘ä»¬èƒ½åœ¨UICollectionViewä¸­é‡å†™<code>hitTest:withEvent:</code>æ–¹æ³•ï¼Œé‚£ä¹ˆä½œä¸ºcollectionViewçš„superviewï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½ç›´æ¥åœ¨å½±é™¢Cellä¸­é‡å†™è¯¥æ–¹æ³•å‘¢ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚åœ¨å½±é™¢Cellä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å–å¾—superclass UIViewçš„<code>hitTest:withEvent:</code>æ–¹æ³•çš„è¿”å›ç»“æœï¼Œè¿›è¡Œä¸­é€”æ‹¦æˆªï¼Œåˆ¤æ–­è¿”å›ç»“æœæ˜¯å¦ä¸ºcollectionViewï¼Œå¦‚æœæ˜¯ï¼Œæˆ‘ä»¬è¿”å›å½±é™¢Cellè‡ªèº«ï¼Œå¦‚æœä¸æ˜¯ï¼ŒåŸæ ·è¿”å›å°±è¡Œï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UIView</span> *)hitTest:(<span class="built_in">CGPoint</span>)point withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</div><div class="line">    <span class="built_in">UIView</span> *view = [<span class="keyword">super</span> hitTest:point withEvent:event];</div><div class="line">    <span class="keyword">if</span> (view == <span class="keyword">self</span>.collectionView) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> view;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ç°åœ¨çœ‹æ¥ï¼Œè¿™æ‰æ˜¯æœ€ç®€å•æœ‰æ•ˆçš„æ–¹æ³•ã€‚</p>
<p>å‚è€ƒèµ„æ–™ï¼š</p>
<ul>
<li><a href="https://developer.apple.com/library/ios/documentation/EventHandling/Conceptual/EventHandlingiPhoneOS/event_delivery_responder_chain/event_delivery_responder_chain.html#//apple_ref/doc/uid/TP40009541-CH4-SW2" target="_blank" rel="external">Event Delivery: The Responder Chain</a></li>
<li><a href="http://smnh.me/hit-testing-in-ios/" target="_blank" rel="external">Hit-Testing in iOS</a></li>
<li><a href="http://stackoverflow.com/questions/11770743/capturing-touches-on-a-subview-outside-the-frame-of-its-superview-using-hittest" target="_blank" rel="external">Capturing touches on a subview outside the frame of its superview using hitTest:withEvent:</a></li>
</ul>

    
  </div>
</article>


   

   
  <div class="box-prev-next clearfix">
    <a class="hide pull-left" href="/">
        <i class="icon icon-angle-left"></i>
    </a>
    <a class="show pull-right" href="/2016/09/08/iOS3Då˜æ¢ä»¥åŠé€è§†ã€é˜´å½±è¯¦è§£/">
        <i class="icon icon-angle-right"></i>
    </a>
  </div>




</div>


  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">Close</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              åšå®¢
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/category/"
              rel="noopener noreferrer"
              target="_self"
              >
              åˆ†ç±»
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tag/"
              rel="noopener noreferrer"
              target="_self"
              >
              æ ‡ç­¾
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/atom.xml"
              rel="noopener noreferrer"
              target="_blank"
              >
              RSS
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/search/"
              rel="noopener noreferrer"
              target="_self"
              >
              æœç´¢
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    

    




    

    
	
  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>
